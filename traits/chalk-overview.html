<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>An Overview of Chalk - Guide to Rustc Development</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to developing rustc">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="../about-this-guide.html">About this guide</a></li><li class="spacer"></li><li><a href="../part-1-intro.html"><strong aria-hidden="true">1.</strong> Part 1: Building, debugging, and contributing to Rustc</a></li><li><a href="../compiler-team.html"><strong aria-hidden="true">2.</strong> About the compiler team</a></li><li><a href="../how-to-build-and-run.html"><strong aria-hidden="true">3.</strong> How to build the compiler and run what you built</a></li><li><ol class="section"><li><a href="../build-install-distribution-artifacts.html"><strong aria-hidden="true">3.1.</strong> Build and Install distribution artifacts</a></li><li><a href="../compiler-documenting.html"><strong aria-hidden="true">3.2.</strong> Documenting Compiler</a></li></ol></li><li><a href="../tests/intro.html"><strong aria-hidden="true">4.</strong> The compiler testing framework</a></li><li><ol class="section"><li><a href="../tests/running.html"><strong aria-hidden="true">4.1.</strong> Running tests</a></li><li><a href="../tests/adding.html"><strong aria-hidden="true">4.2.</strong> Adding new tests</a></li><li><a href="../compiletest.html"><strong aria-hidden="true">4.3.</strong> Using compiletest + commands to control test execution</a></li></ol></li><li><a href="../walkthrough.html"><strong aria-hidden="true">5.</strong> Walkthrough: a typical contribution</a></li><li><a href="../implementing_new_features.html"><strong aria-hidden="true">6.</strong> Implementing new features</a></li><li><a href="../stabilization_guide.html"><strong aria-hidden="true">7.</strong> Stabilizing Features</a></li><li><a href="../compiler-debugging.html"><strong aria-hidden="true">8.</strong> Debugging the Compiler</a></li><li><a href="../profiling.html"><strong aria-hidden="true">9.</strong> Profiling the compiler</a></li><li><ol class="section"><li><a href="../profiling/with_perf.html"><strong aria-hidden="true">9.1.</strong> with the linux perf tool</a></li></ol></li><li><a href="../conventions.html"><strong aria-hidden="true">10.</strong> Coding conventions</a></li><li><a href="../crates-io.html"><strong aria-hidden="true">11.</strong> crates.io Dependencies</a></li><li class="spacer"></li><li><a href="../part-2-intro.html"><strong aria-hidden="true">12.</strong> Part 2: How rustc works</a></li><li><a href="../high-level-overview.html"><strong aria-hidden="true">13.</strong> High-level overview of the compiler source</a></li><li><a href="../rustc-driver.html"><strong aria-hidden="true">14.</strong> The Rustc Driver and Interface</a></li><li><ol class="section"><li><a href="../rustdoc.html"><strong aria-hidden="true">14.1.</strong> Rustdoc</a></li></ol></li><li><a href="../query.html"><strong aria-hidden="true">15.</strong> Queries: demand-driven compilation</a></li><li><ol class="section"><li><a href="../queries/query-evaluation-model-in-detail.html"><strong aria-hidden="true">15.1.</strong> The Query Evaluation Model in Detail</a></li><li><a href="../queries/incremental-compilation.html"><strong aria-hidden="true">15.2.</strong> Incremental compilation</a></li><li><a href="../queries/incremental-compilation-in-detail.html"><strong aria-hidden="true">15.3.</strong> Incremental compilation In Detail</a></li><li><a href="../incrcomp-debugging.html"><strong aria-hidden="true">15.4.</strong> Debugging and Testing</a></li></ol></li><li><a href="../the-parser.html"><strong aria-hidden="true">16.</strong> The parser</a></li><li><a href="../test-implementation.html"><strong aria-hidden="true">17.</strong> #[test] Implementation</a></li><li><a href="../macro-expansion.html"><strong aria-hidden="true">18.</strong> Macro expansion</a></li><li><a href="../name-resolution.html"><strong aria-hidden="true">19.</strong> Name resolution</a></li><li><a href="../hir.html"><strong aria-hidden="true">20.</strong> The HIR (High-level IR)</a></li><li><ol class="section"><li><a href="../lowering.html"><strong aria-hidden="true">20.1.</strong> Lowering AST to HIR</a></li><li><a href="../hir-debugging.html"><strong aria-hidden="true">20.2.</strong> Debugging</a></li></ol></li><li><a href="../ty.html"><strong aria-hidden="true">21.</strong> The ty module: representing types</a></li><li><a href="../kinds.html"><strong aria-hidden="true">22.</strong> Kinds</a></li><li><a href="../type-inference.html"><strong aria-hidden="true">23.</strong> Type inference</a></li><li><a href="../traits/resolution.html"><strong aria-hidden="true">24.</strong> Trait solving (old-style)</a></li><li><ol class="section"><li><a href="../traits/hrtb.html"><strong aria-hidden="true">24.1.</strong> Higher-ranked trait bounds</a></li><li><a href="../traits/caching.html"><strong aria-hidden="true">24.2.</strong> Caching subtleties</a></li><li><a href="../traits/specialization.html"><strong aria-hidden="true">24.3.</strong> Specialization</a></li></ol></li><li><a href="../traits/index.html"><strong aria-hidden="true">25.</strong> Trait solving (new-style)</a></li><li><ol class="section"><li><a href="../traits/lowering-to-logic.html"><strong aria-hidden="true">25.1.</strong> Lowering to logic</a></li><li><ol class="section"><li><a href="../traits/goals-and-clauses.html"><strong aria-hidden="true">25.1.1.</strong> Goals and clauses</a></li><li><a href="../traits/associated-types.html"><strong aria-hidden="true">25.1.2.</strong> Equality and associated types</a></li><li><a href="../traits/implied-bounds.html"><strong aria-hidden="true">25.1.3.</strong> Implied bounds</a></li><li><a href="../traits/regions.html"><strong aria-hidden="true">25.1.4.</strong> Region constraints</a></li><li><a href="../traits/lowering-module.html"><strong aria-hidden="true">25.1.5.</strong> The lowering module in rustc</a></li><li><a href="../traits/lowering-rules.html"><strong aria-hidden="true">25.1.6.</strong> Lowering rules</a></li><li><a href="../traits/wf.html"><strong aria-hidden="true">25.1.7.</strong> Well-formedness checking</a></li></ol></li><li><a href="../traits/canonical-queries.html"><strong aria-hidden="true">25.2.</strong> Canonical queries</a></li><li><ol class="section"><li><a href="../traits/canonicalization.html"><strong aria-hidden="true">25.2.1.</strong> Canonicalization</a></li></ol></li><li><a href="../traits/slg.html"><strong aria-hidden="true">25.3.</strong> The SLG solver</a></li><li><a href="../traits/chalk-overview.html" class="active"><strong aria-hidden="true">25.4.</strong> An Overview of Chalk</a></li><li><a href="../traits/bibliography.html"><strong aria-hidden="true">25.5.</strong> Bibliography</a></li></ol></li><li><a href="../type-checking.html"><strong aria-hidden="true">26.</strong> Type checking</a></li><li><ol class="section"><li><a href="../method-lookup.html"><strong aria-hidden="true">26.1.</strong> Method Lookup</a></li><li><a href="../variance.html"><strong aria-hidden="true">26.2.</strong> Variance</a></li><li><a href="../existential-types.html"><strong aria-hidden="true">26.3.</strong> Existential Types</a></li></ol></li><li><a href="../mir/index.html"><strong aria-hidden="true">27.</strong> The MIR (Mid-level IR)</a></li><li><ol class="section"><li><a href="../mir/construction.html"><strong aria-hidden="true">27.1.</strong> MIR construction</a></li><li><a href="../mir/visitor.html"><strong aria-hidden="true">27.2.</strong> MIR visitor and traversal</a></li><li><a href="../mir/passes.html"><strong aria-hidden="true">27.3.</strong> MIR passes: getting the MIR for a function</a></li><li><a href="../mir/optimizations.html"><strong aria-hidden="true">27.4.</strong> MIR optimizations</a></li><li><a href="../mir/debugging.html"><strong aria-hidden="true">27.5.</strong> Debugging</a></li></ol></li><li><a href="../borrow_check.html"><strong aria-hidden="true">28.</strong> The borrow checker</a></li><li><ol class="section"><li><a href="../borrow_check/moves_and_initialization.html"><strong aria-hidden="true">28.1.</strong> Tracking moves and initialization</a></li><li><ol class="section"><li><a href="../borrow_check/moves_and_initialization/move_paths.html"><strong aria-hidden="true">28.1.1.</strong> Move paths</a></li></ol></li><li><a href="../borrow_check/type_check.html"><strong aria-hidden="true">28.2.</strong> MIR type checker</a></li><li><a href="../borrow_check/region_inference.html"><strong aria-hidden="true">28.3.</strong> Region inference</a></li></ol></li><li><a href="../const-eval.html"><strong aria-hidden="true">29.</strong> Constant evaluation</a></li><li><ol class="section"><li><a href="../miri.html"><strong aria-hidden="true">29.1.</strong> miri const evaluator</a></li></ol></li><li><a href="../param_env.html"><strong aria-hidden="true">30.</strong> Parameter Environments</a></li><li><a href="../codegen.html"><strong aria-hidden="true">31.</strong> Code Generation</a></li><li><ol class="section"><li><a href="../codegen/updating-llvm.html"><strong aria-hidden="true">31.1.</strong> Updating LLVM</a></li><li><a href="../codegen/debugging.html"><strong aria-hidden="true">31.2.</strong> Debugging LLVM</a></li></ol></li><li><a href="../diag.html"><strong aria-hidden="true">32.</strong> Emitting Diagnostics</a></li><li><ol class="section"><li><a href="../diag/json-format.html"><strong aria-hidden="true">32.1.</strong> JSON diagnostic format</a></li><li class="spacer"></li></ol></li><li><a href="../appendix/stupid-stats.html">Appendix A: Stupid Stats</a></li><li class="affix"><a href="../appendix/background.html">Appendix B: Background material</a></li><li class="affix"><a href="../appendix/glossary.html">Appendix C: Glossary</a></li><li class="affix"><a href="../appendix/code-index.html">Appendix D: Code Index</a></li><li class="affix"><a href="../important-links.html"></a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Guide to Rustc Development</h1> 

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#an-overview-of-chalk" id="an-overview-of-chalk"><h1>An Overview of Chalk</h1></a>
<blockquote>
<p>Chalk is under heavy development, so if any of these links are broken or if
any of the information is inconsistent with the code or outdated, please
<a href="https://github.com/rust-lang/rustc-guide/issues">open an issue</a> so we can fix it. If you are able to fix the
issue yourself, we would love your contribution!</p>
</blockquote>
<p><a href="https://github.com/rust-lang/chalk">Chalk</a> recasts Rust's trait system explicitly in terms of logic
programming by &quot;lowering&quot; Rust code into a kind of logic program we can then
execute queries against. (See <a href="./lowering-to-logic.html"><em>Lowering to Logic</em></a> and
<a href="./lowering-rules.html"><em>Lowering Rules</em></a>) Its goal is to be an executable, highly
readable specification of the Rust trait system.</p>
<p>There are many expected benefits from this work. It will consolidate our
existing, somewhat ad-hoc implementation into something far more principled and
expressive, which should behave better in corner cases, and be much easier to
extend.</p>
<a class="header" href="#chalk-structure" id="chalk-structure"><h2>Chalk Structure</h2></a>
<p>Chalk has two main &quot;products&quot;. The first of these is the
<a href="https://rust-lang.github.io/chalk/doc/chalk_engine/index.html"><code>chalk_engine</code></a> crate, which defines the core <a href="./slg.html">SLG
solver</a>. This is the part rustc uses.</p>
<p>The rest of chalk can be considered an elaborate testing harness. Chalk is
capable of parsing Rust-like &quot;programs&quot;, lowering them to logic, and
performing queries on them.</p>
<p>Here's a sample session in the chalk repl, chalki. After feeding it our
program, we perform some queries on it.</p>
<pre><code class="language-rust ignore">?- program
Enter a program; press Ctrl-D when finished
| struct Foo { }
| struct Bar { }
| struct Vec&lt;T&gt; { }
| trait Clone { }
| impl&lt;T&gt; Clone for Vec&lt;T&gt; where T: Clone { }
| impl Clone for Foo { }

?- Vec&lt;Foo&gt;: Clone
Unique; substitution [], lifetime constraints []

?- Vec&lt;Bar&gt;: Clone
No possible solution.

?- exists&lt;T&gt; { Vec&lt;T&gt;: Clone }
Ambiguous; no inference guidance
</code></pre>
<p>You can see more examples of programs and queries in the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L115">unit
tests</a>.</p>
<p>Next we'll go through each stage required to produce the output above.</p>
<a class="header" href="#parsing-a-hrefhttpsrust-langgithubiochalkdocchalk_parseindexhtmlchalk_parsea" id="parsing-a-hrefhttpsrust-langgithubiochalkdocchalk_parseindexhtmlchalk_parsea"><h3>Parsing (<a href="https://rust-lang.github.io/chalk/doc/chalk_parse/index.html">chalk_parse</a>)</h3></a>
<p>Chalk is designed to be incorporated with the Rust compiler, so the syntax and
concepts it deals with heavily borrow from Rust. It is convenient for the sake
of testing to be able to run chalk on its own, so chalk includes a parser for a
Rust-like syntax. This syntax is orthogonal to the Rust AST and grammar. It is
not intended to look exactly like it or support the exact same syntax.</p>
<p>The parser takes that syntax and produces an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree (AST)</a>.
You can find the <a href="http://rust-lang.github.io/chalk/doc/chalk_parse/ast/index.html">complete definition of the AST</a> in the source code.</p>
<p>The syntax contains things from Rust that we know and love, for example: traits,
impls, and struct definitions. Parsing is often the first &quot;phase&quot; of
transformation that a program goes through in order to become a format that
chalk can understand.</p>
<a class="header" href="#rust-intermediate-representation-a-hrefhttpsrust-langgithubiochalkdocchalk_rust_irindexhtmlchalk_rust_ira" id="rust-intermediate-representation-a-hrefhttpsrust-langgithubiochalkdocchalk_rust_irindexhtmlchalk_rust_ira"><h3>Rust Intermediate Representation (<a href="https://rust-lang.github.io/chalk/doc/chalk_rust_ir/index.html">chalk_rust_ir</a>)</h3></a>
<p>After getting the AST we convert it to a more convenient intermediate
representation called <a href="https://rust-lang.github.io/chalk/doc/chalk_rust_ir/index.html"><code>chalk_rust_ir</code></a>. This is sort of
analogous to the <a href="../hir.html">HIR</a> in Rust. The process of converting to IR is called
<em>lowering</em>.</p>
<p>The <a href="http://rust-lang.github.io/chalk/doc/chalk/program/struct.Program.html"><code>chalk::program::Program</code></a> struct contains some &quot;rust things&quot;
but indexed and accessible in a different way. For example, if you have a
type like <code>Foo&lt;Bar&gt;</code>, we would represent <code>Foo</code> as a string in the AST but in
<code>chalk::program::Program</code>, we use numeric indices (<code>ItemId</code>).</p>
<p>The <a href="http://rust-lang.github.io/chalk/doc/chalk_rust_ir/">IR source code</a> contains the complete definition.</p>
<a class="header" href="#chalk-intermediate-representation-a-hrefhttpsrust-langgithubiochalkdocchalk_irindexhtmlchalk_ira" id="chalk-intermediate-representation-a-hrefhttpsrust-langgithubiochalkdocchalk_irindexhtmlchalk_ira"><h3>Chalk Intermediate Representation (<a href="https://rust-lang.github.io/chalk/doc/chalk_ir/index.html">chalk_ir</a>)</h3></a>
<p>Once we have Rust IR it is time to convert it to &quot;program clauses&quot;. A
<a href="https://rust-lang.github.io/chalk/doc/chalk_ir/enum.ProgramClause.html"><code>ProgramClause</code></a> is essentially one of the following:</p>
<ul>
<li>A <a href="https://github.com/rust-lang/chalk/blob/master/GLOSSARY.md#clause">clause</a> of the form <code>consequence :- conditions</code> where <code>:-</code> is read as
&quot;if&quot; and <code>conditions = cond1 &amp;&amp; cond2 &amp;&amp; ...</code></li>
<li>A universally quantified clause of the form
<code>forall&lt;T&gt; { consequence :- conditions }</code>
<ul>
<li><code>forall&lt;T&gt; { ... }</code> is used to represent <a href="https://en.wikipedia.org/wiki/Universal_quantification">universal quantification</a>. See the
section on <a href="./lowering-to-logic.html#type-checking-generic-functions-beyond-horn-clauses">Lowering to logic</a> for more information.</li>
<li>A key thing to note about <code>forall</code> is that we don't allow you to &quot;quantify&quot;
over traits, only types and regions (lifetimes). That is, you can't make a
rule like <code>forall&lt;Trait&gt; { u32: Trait }</code> which would say &quot;<code>u32</code> implements
all traits&quot;. You can however say <code>forall&lt;T&gt; { T: Trait }</code> meaning &quot;<code>Trait</code>
is implemented by all types&quot;.</li>
<li><code>forall&lt;T&gt; { ... }</code> is represented in the code using the <a href="http://rust-lang.github.io/chalk/doc/chalk_ir/struct.Binders.html"><code>Binders&lt;T&gt;</code>
struct</a>.</li>
</ul>
</li>
</ul>
<p><em>See also: <a href="./goals-and-clauses.html">Goals and Clauses</a></em></p>
<p>This is where we encode the rules of the trait system into logic. For
example, if we have the following Rust:</p>
<pre><code class="language-rust ignore">impl&lt;T: Clone&gt; Clone for Vec&lt;T&gt; {}
</code></pre>
<p>We generate the following program clause:</p>
<pre><code class="language-rust ignore">forall&lt;T&gt; { (Vec&lt;T&gt;: Clone) :- (T: Clone) }
</code></pre>
<p>This rule dictates that <code>Vec&lt;T&gt;: Clone</code> is only satisfied if <code>T: Clone</code> is also
satisfied (i.e. &quot;provable&quot;).</p>
<p>Similar to <a href="http://rust-lang.github.io/chalk/doc/chalk/program/struct.Program.html"><code>chalk::program::Program</code></a> which has &quot;rust-like
things&quot;, chalk_ir defines <a href="http://rust-lang.github.io/chalk/doc/chalk/program_environment/struct.ProgramEnvironment.html"><code>ProgramEnvironment</code></a> which which is &quot;pure logic&quot;.
The main field in that struct is <code>program_clauses</code>, which contains the
<a href="https://rust-lang.github.io/chalk/doc/chalk_ir/enum.ProgramClause.html"><code>ProgramClause</code></a>s generated by the rules module.</p>
<a class="header" href="#rules-a-hrefhttpsrust-langgithubiochalkdocchalk_rulesindexhtmlchalk_rulesa" id="rules-a-hrefhttpsrust-langgithubiochalkdocchalk_rulesindexhtmlchalk_rulesa"><h3>Rules (<a href="https://rust-lang.github.io/chalk/doc/chalk_rules/index.html">chalk_rules</a>)</h3></a>
<p>The <code>chalk_rules</code> crate (<a href="https://rust-lang.github.io/chalk/doc/chalk_rules/index.html">source code</a>) defines the logic rules we use
for each item in the Rust IR. It works by iterating over every trait, impl,
etc. and emitting the rules that come from each one.</p>
<p><em>See also: <a href="./lowering-rules.html">Lowering Rules</a></em></p>
<a class="header" href="#well-formedness-checks" id="well-formedness-checks"><h4>Well-formedness checks</h4></a>
<p>As part of lowering to logic, we also do some &quot;well formedness&quot; checks. See
the <a href="http://rust-lang.github.io/chalk/doc/chalk_rules/wf/index.html"><code>chalk_rules::wf</code> source code</a> for where those are done.</p>
<p><em>See also: <a href="./wf.html">Well-formedness checking</a></em></p>
<a class="header" href="#coherence" id="coherence"><h4>Coherence</h4></a>
<p>The method <code>CoherenceSolver::specialization_priorities</code> in the <code>coherence</code> module
(<a href="http://rust-lang.github.io/chalk/doc/chalk_rules/coherence/index.html">source code</a>) checks &quot;coherence&quot;, which means that it
ensures that two impls of the same trait for the same type cannot exist.</p>
<a class="header" href="#solver-a-hrefhttpsrust-langgithubiochalkdocchalk_solveindexhtmlchalk_solvea" id="solver-a-hrefhttpsrust-langgithubiochalkdocchalk_solveindexhtmlchalk_solvea"><h3>Solver (<a href="https://rust-lang.github.io/chalk/doc/chalk_solve/index.html">chalk_solve</a>)</h3></a>
<p>Finally, when we've collected all the program clauses we care about, we want
to perform queries on it. The component that finds the answer to these
queries is called the <em>solver</em>.</p>
<p><em>See also: <a href="./slg.html">The SLG Solver</a></em></p>
<a class="header" href="#crates" id="crates"><h2>Crates</h2></a>
<p>Chalk's functionality is broken up into the following crates:</p>
<ul>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk_engine/index.html"><strong>chalk_engine</strong></a>: Defines the core <a href="./slg.html">SLG solver</a>.</li>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk_rust_ir/index.html"><strong>chalk_rust_ir</strong></a>, containing the &quot;HIR-like&quot; form of the AST</li>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk_ir/index.html"><strong>chalk_ir</strong></a>: Defines chalk's internal representation of
types, lifetimes, and goals.</li>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk_solve/index.html"><strong>chalk_solve</strong></a>: Combines <code>chalk_ir</code> and <code>chalk_engine</code>,
effectively.
<ul>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk_engine/context/index.html"><code>chalk_engine::context</code></a> provides the necessary hooks.</li>
</ul>
</li>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk_parse/index.html"><strong>chalk_parse</strong></a>: Defines the raw AST and a parser.</li>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk_rules/index.html"><strong>chalk_rules</strong></a>: which implements logic rules converting
<code>chalk_rust_ir</code> to <code>chalk_ir</code>
<ul>
<li>Defines the <code>coherence</code> module, which implements coherence rules</li>
</ul>
</li>
<li><a href="https://rust-lang.github.io/chalk/doc/chalk/index.html"><strong>chalk</strong></a>: Brings everything together. Defines the following
modules:
<ul>
<li><code>chalk::lowering</code>, which converts AST to <code>chalk_rust_ir</code></li>
<li>Also includes <a href="https://rust-lang.github.io/chalk/doc/chalki/index.html">chalki</a>, chalk's REPL.</li>
</ul>
</li>
</ul>
<p><a href="https://github.com/rust-lang/chalk">Browse source code on GitHub</a></p>
<a class="header" href="#testing" id="testing"><h2>Testing</h2></a>
<p>chalk has a test framework for lowering programs to logic, checking the
lowered logic, and performing queries on it. This is how we test the
implementation of chalk itself, and the viability of the <a href="./lowering-rules.html">lowering
rules</a>.</p>
<p>The main kind of tests in chalk are <strong>goal tests</strong>. They contain a program,
which is expected to lower to logic successfully, and a set of queries
(goals) along with the expected output. Here's an
<a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L115">example</a>. Since chalk's output can be quite long, goal
tests support specifying only a prefix of the output.</p>
<p><strong>Lowering tests</strong> check the stages that occur before we can issue queries
to the solver: the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/rust_ir/lowering/test.rs">lowering to chalk_rust_ir</a>, and the
<a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/rules/wf/test.rs#L1">well-formedness checks</a> that occur after that.</p>
<a class="header" href="#testing-internals" id="testing-internals"><h3>Testing internals</h3></a>
<p>Goal tests use a <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L33"><code>test!</code> macro</a> that takes chalk's Rust-like
syntax and runs it through the full pipeline described above. The macro
ultimately calls the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L85"><code>solve_goal</code> function</a>.</p>
<p>Likewise, lowering tests use the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test_util.rs#L21-L54"><code>lowering_success!</code> and
<code>lowering_error!</code> macros</a>.</p>
<a class="header" href="#more-resources" id="more-resources"><h2>More Resources</h2></a>
<ul>
<li><a href="https://github.com/rust-lang/chalk">Chalk Source Code</a></li>
<li><a href="https://github.com/rust-lang/chalk/blob/master/GLOSSARY.md">Chalk Glossary</a></li>
</ul>
<a class="header" href="#blog-posts" id="blog-posts"><h3>Blog Posts</h3></a>
<ul>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/01/26/lowering-rust-traits-to-logic/">Lowering Rust traits to logic</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/03/25/unification-in-chalk-part-1/">Unification in Chalk, part 1</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/04/23/unification-in-chalk-part-2/">Unification in Chalk, part 2</a></li>
<li><a href="http://aturon.github.io/blog/2017/04/24/negative-chalk/">Negative reasoning in Chalk</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/05/25/query-structure-in-chalk/">Query structure in chalk</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/09/12/tabling-handling-cyclic-queries-in-chalk/">Cyclic queries in chalk</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2018/01/31/an-on-demand-slg-solver-for-chalk/">An on-demand SLG solver for chalk</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../traits/slg.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../traits/bibliography.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../traits/slg.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../traits/bibliography.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
